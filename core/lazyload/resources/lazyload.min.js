!function(t){var e=200,o="lazy-image-",i=".lazy-image",a="lazy-placeholder",r=1.777777778,n='<div class="loader"></div>',s={viewportChanged:!1,touchScrolling:!1,resized:!1},d=[],c=function(){t(d).each(function(){if(!this.hasPlaceholderImage&&!this.asBackground){var e=t("."+o+this.id),i=e.attr("class");"string"==typeof i&&(i=i.replace(o+this.id,""));var r=t("<div/>",{class:a+" "+i}).css({position:"relative",display:"block"});r.append(t("<div/>").css({height:0,"padding-bottom":100*this.aspectRatio+"%"})),r.append(t(n)),r.insertAfter(e)}})},u=function(){var i,r=(i=function(){return t.grep(d,function(o){if(void 0===o)return!1;var i=t(window).scrollTop(),a=t(window).innerHeight(),r=i-200-e,n=i+a+200+e;return o.boundaries.top>=r&&o.boundaries.top<=n||o.boundaries.top<=r&&o.boundaries.bottom<=n&&o.boundaries.bottom>=r})},s.resized?(s.resized=!1,l(i())):i());t(r).each(function(){var e=t("<img/>",{src:this.source}),i=this;e.on("load",function(){delete d[i.id];var e=t("."+o+i.id),r=e.next("."+a);e.attr("src",i.source),e.addClass("loaded"),i.asBackground?t("."+o+i.id).css({backgroundImage:"url("+i.source+")"}):i.hasPlaceholderImage||r.remove(),t(document).trigger("lazyimage-loaded",{type:"success",imageId:"."+o+i.id})}),e.on("error",function(){delete d[i.id],t(document).trigger("lazyimage-loaded",{type:"error",imageId:"."+o+i.id})})})},l=function(e){for(var i in d){var r=d[i],n=t("."+o+r.id),s=n.next("."+a),c=s.length>0?s.offset().top:n.offset().top;r.boundaries={top:c,bottom:c+(s.length>0?s.outerHeight():n.outerHeight())},d[i]=r}if("function"==typeof e)return e()};t.fn.lazyLoad=function(e){t(i).each(function(e){t(this).addClass(o+e);var i=parseInt(t(this).attr("data-width")),a=parseInt(t(this).attr("data-height")),n=r,s=t(this).attr("data-as-background");i&&a&&(n=a/i),d.push({id:e,source:t(this).attr("data-src"),boundaries:{},hasPlaceholderImage:t(this).hasClass("lazyimage"),width:i,height:a,aspectRatio:n,asBackground:s,html:t(this)[0].outerHTML})}),c(),l(),setInterval(function(){!0!==s.viewportChanged&&!0!==s.touchScrolling||(u(),s.viewportChanged=!1,s.touchScrolling=!1)},250),t(document).on("touchmove",function(){s.touchScrolling=!0}),t(window).on("scroll resize",function(){s.viewportChanged=!0,s.touchScrolling=!1}),t(window).on("resize",function(){s.resized=!0}),u()}}(jQuery);
